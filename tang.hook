#! /bin/bash

set -e

if ! go test -v;
then
	echo "Tests failed"
	exit 1
fi

echo "Would have built tang"

mkdir -p gopath/src
ln -s $PWD gopath/src/tang

echo "Installing..."
GOPATH=$PWD/gopath go install tang

# Must delete old binary before replacing it
ORIGBIN=${GOPATH-~/.local}/bin/tang
mv $ORIGBIN $ORIGBIN.old
cp $PWD/gopath/bin/tang $ORIGBIN

pkill -HUP tang